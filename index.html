<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phone Pe</title>
  <!-- Include html2pdf library for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <style>
    /* Global resets and styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      position: relative;
    }
    /* Notification styling */
    #notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background-color: #6C45D5;
      color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 10000;
    }
    #notification.error { background-color: #e74c3c; }
    /* Animations */
    @keyframes splashIn {
      0% { opacity: 0; transform: scale(0.8); }
      100% { opacity: 1; transform: scale(1); }
    }
    @keyframes splashOut {
      0% { opacity: 1; }
      100% { opacity: 0; transform: scale(0.95); }
    }
    @keyframes phoneSlideUp {
      0% { opacity: 0; transform: translateY(50px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes iconSpin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes navHover {
      0% { transform: scale(1); }
      100% { transform: scale(1.1); }
    }
    /* Splash and Data Views */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
      animation: splashIn 1s ease forwards;
    }
    #splash.fade-out { animation: splashOut 0.8s ease forwards; }
    #splash img { width: 150px; height: 150px; margin-bottom: 20px; }
    #data {
      display: none;
      width: 100%;
      min-height: 100vh;
      padding: 20px;
      justify-content: center;
      align-items: center;
      animation: phoneSlideUp 0.8s ease forwards;
    }
    /* Phone mock and navigation */
    .phone-mock {
      width: 360px;
      max-width: 100%;
      background-color: #ffffff;
      border-radius: 30px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }
    .phone-header {
      background-color: #6C45D5;
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    .phone-content { padding: 20px; flex: 1; overflow-y: auto; }
    .section-title { font-weight: bold; margin-bottom: 10px; font-size: 16px; }
    .icon-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px; margin-bottom: 20px;
    }
    .icon-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      font-size: 14px;
      color: #555;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .icon-item:hover img { animation: iconSpin 0.7s ease; }
    .icon-item:hover { transform: scale(1.1); }
    .upi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .upi-item {
      flex: 1;
      min-width: 100px;
      background-color: #e9e5f7;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      font-size: 14px;
      color: #6C45D5;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .bill-section {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 20px;
    }
    .phone-nav {
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
      border-top: 1px solid #ccc;
      background-color: #fff;
      transition: background-color 0.3s;
    }
    .phone-nav a {
      text-decoration: none;
      color: #666;
      font-size: 14px;
      transition: color 0.3s, transform 0.3s;
      cursor: pointer;
    }
    .phone-nav a.active {
      color: #6C45D5;
      font-weight: bold;
      transform: scale(1.1);
    }
    .phone-nav a:hover {
      color: #6C45D5;
      animation: navHover 0.3s forwards;
    }
    /* Forms */
    .login-form,
    .register-form {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .login-form input,
    .register-form input {
      margin: 10px 0;
      padding: 10px;
      width: 80%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .login-form button,
    .register-form button {
      padding: 10px 20px;
      background-color: #6C45D5;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .login-form button:hover,
    .register-form button:hover {
      background-color: #5a37b0;
    }
    .toggle-link {
      margin-top: 10px;
      cursor: pointer;
      color: #6C45D5;
    }
    /* Back button */
    .back-button {
      margin-bottom: 15px;
      cursor: pointer;
      color: #6C45D5;
      font-weight: bold;
    }
    @media (max-width: 400px) {
      .phone-mock { width: 100%; border-radius: 0; }
      .icon-grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (min-width: 1024px) {
      .phone-mock { width: 100%; border-radius: 0; }
    }
    /* Table styling for History */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: left;
    }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>
  <!-- Notification Element -->
  <div id="notification"></div>
  <!-- Splash Screen (Login/Sign-Up) -->
  <div id="splash">
    <img src="https://pbs.twimg.com/profile_images/1615271089705463811/v-emhrqu_200x200.png" alt="Logo">
    <h1>Phone Pe</h1>
    <!-- Local Login Form -->
    <div class="login-form" id="local-login">
      <input type="text" id="username" placeholder="Username" required>
      <input type="password" id="password" placeholder="Password" required>
      <button onclick="login()">Sign In</button>
      <span class="toggle-link" onclick="toggleToRegister()">Create New Account</span>
    </div>
    <!-- Registration Form (initially hidden) -->
    <div class="register-form" id="register-form" style="display: none;">
      <h2>Create Account</h2>
      <input type="text" id="new-username" placeholder="Username" required>
      <input type="password" id="new-password" placeholder="Password" required>
      <button onclick="createAccount()">Create Account</button>
      <span class="toggle-link" onclick="toggleToLogin()">Already have an account? Sign In</span>
    </div>
  </div>
  <!-- Main Content -->
  <div id="data">
    <div class="phone-mock">
      <div class="phone-header">
        <h1>Phone Pe</h1>
        <div class="location">Location</div>
      </div>
      <div class="phone-content" id="content-area">
        <!-- Content will load here -->
      </div>
      <div class="phone-nav">
        <a href="#" class="active" onclick="showContent('home')">Home</a>
        <a href="#" onclick="showContent('stores')">Stores</a>
        <a href="#" onclick="showContent('insurance')">Insurance</a>
        <a href="#" onclick="showContent('wealth')">Wealth</a>
        <a href="#" onclick="showContent('history')">History</a>
      </div>
    </div>
  </div>
  <script>
    // Global variable to track the current logged in user
    let currentUser = '';

    // --------------------------
    // Custom Notification Function
    // --------------------------
    function displayNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      if (type === 'error') {
        notification.classList.add('error');
      } else {
        notification.classList.remove('error');
      }
      notification.style.opacity = '1';
      setTimeout(() => { notification.style.opacity = '0'; }, 3000);
    }

    // --------------------------
    // Local Login / Registration
    // --------------------------
    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const storedPassword = localStorage.getItem(username);
      if (storedPassword && storedPassword === password) {
        currentUser = username; // set current user
        displayNotification('Logged in successfully as: ' + username);
        enterApp();
      } else {
        displayNotification('Invalid username or password', 'error');
      }
    }
    function createAccount() {
      const newUsername = document.getElementById('new-username').value;
      const newPassword = document.getElementById('new-password').value;
      if (newUsername && newPassword) {
        if (localStorage.getItem(newUsername)) {
          displayNotification('Username already exists. Please choose a different one.', 'error');
        } else {
          localStorage.setItem(newUsername, newPassword);
          displayNotification('Account created successfully! You can now log in.');
          toggleToLogin();
        }
      } else {
        displayNotification('Please fill in all fields', 'error');
      }
    }
    function toggleToRegister() {
      document.getElementById('local-login').style.display = 'none';
      document.getElementById('register-form').style.display = 'flex';
    }
    function toggleToLogin() {
      document.getElementById('local-login').style.display = 'flex';
      document.getElementById('register-form').style.display = 'none';
    }
    // --------------------------
    // Enter the main app view and initialize balances if needed
    // --------------------------
    function enterApp() {
      document.getElementById("splash").classList.add("fade-out");
      setTimeout(function () {
        document.getElementById("splash").style.display = "none";
        document.getElementById("data").style.display = "flex";
        // Initialize balances if not set
        if (!localStorage.getItem('balance_' + currentUser)) {
          localStorage.setItem('balance_' + currentUser, 1000);
        }
        if (!localStorage.getItem('balance_' + currentUser + '_savings')) {
          localStorage.setItem('balance_' + currentUser + '_savings', 1000);
        }
        if (!localStorage.getItem('balance_' + currentUser + '_current')) {
          localStorage.setItem('balance_' + currentUser + '_current', 500);
        }
        showContent('home');
      }, 800);
    }

    // --------------------------
    // Helper: Update History if "History" tab is active
    // --------------------------
    function updateHistoryIfActive() {
      const activeNav = document.querySelector('.phone-nav a.active');
      if (activeNav && activeNav.textContent.trim().toLowerCase() === 'history') {
        showContent('history');
      }
    }

    // --------------------------
    // Content Templates
    // --------------------------
    const homeContent = `
      <div class="section-title">Transfer Money</div>
      <div class="icon-grid">
        <div class="icon-item" onclick="openSubContent('mobileToMobile')">
          <img src="https://via.placeholder.com/40" alt="Mobile">
          <span>To Mobile</span>
        </div>
        <div class="icon-item" onclick="openSubContent('toBank')">
          <img src="https://via.placeholder.com/40" alt="Bank">
          <span>To Bank</span>
        </div>
        <div class="icon-item" onclick="openSubContent('toSelf')">
          <img src="https://via.placeholder.com/40" alt="Self">
          <span>To Self</span>
        </div>
        <div class="icon-item" onclick="openSubContent('checkBalance')">
          <img src="https://via.placeholder.com/40" alt="Balance">
          <span>Check Bal.</span>
        </div>
      </div>
      <div class="upi-row">
        <div class="upi-item">My UPI ID: Rdhanani@ybl</div>
        <div class="upi-item">Rewards</div>
        <div class="upi-item">Refer & Get 100</div>
      </div>
      <div class="section-title">Recharge & Pay Bills</div>
      <div class="bill-section">
        <div class="icon-grid">
          <div class="icon-item" onclick="openSubContent('mobileRecharge')">
            <img src="https://via.placeholder.com/40" alt="Mobile">
            <span>Mobile</span>
          </div>
          <div class="icon-item" onclick="openSubContent('dthRecharge')">
            <img src="https://via.placeholder.com/40" alt="DTH">
            <span>DTH</span>
          </div>
          <div class="icon-item" onclick="openSubContent('electricityBill')">
            <img src="https://via.placeholder.com/40" alt="Electricity">
            <span>Electricity</span>
          </div>
          <div class="icon-item" onclick="openSubContent('creditCardPayment')">
            <img src="https://via.placeholder.com/40" alt="Credit Card">
            <span>Credit Card</span>
          </div>
        </div>
      </div>
      <div class="section-title">Sponsored Links</div>
      <div class="sponsored-links">
        <div class="icon-grid">
          <div class="icon-item" onclick="openSubContent('store')">
            <img src="https://via.placeholder.com/40" alt="Store">
            <span>Stores</span>
          </div>
          <div class="icon-item" onclick="openSubContent('insurance')">
            <img src="https://via.placeholder.com/40" alt="Insurance">
            <span>Insurance</span>
          </div>
          <div class="icon-item" onclick="openSubContent('wealth')">
            <img src="https://via.placeholder.com/40" alt="Wealth">
            <span>Wealth</span>
          </div>
        </div>
      </div>
    `;

    // For Stores
    const storeContent = `
      <div class="section-title">Nearby Stores</div>
      <div class="icon-grid">
        <div class="icon-item" onclick="openStoreSubContent('Grocery Store')">
          <img src="https://via.placeholder.com/40" alt="Grocery Store">
          <span>Grocery Store</span>
        </div>
        <div class="icon-item" onclick="openStoreSubContent('Electronics Store')">
          <img src="https://via.placeholder.com/40" alt="Electronics Store">
          <span>Electronics</span>
        </div>
        <div class="icon-item" onclick="openStoreSubContent('Clothing Store')">
          <img src="https://via.placeholder.com/40" alt="Clothing Store">
          <span>Clothing</span>
        </div>
        <div class="icon-item" onclick="openStoreSubContent('Pharmacy')">
          <img src="https://via.placeholder.com/40" alt="Pharmacy">
          <span>Pharmacy</span>
        </div>
      </div>
    `;

    // For Insurance
    const insuranceContent = `
      <div class="section-title">Insurance Plans</div>
      <div class="icon-grid">
        <div class="icon-item" onclick="openInsuranceSubContent('Health Insurance')">
          <img src="https://via.placeholder.com/40" alt="Health Insurance">
          <span>Health Insurance</span>
        </div>
        <div class="icon-item" onclick="openInsuranceSubContent('Car Insurance')">
          <img src="https://via.placeholder.com/40" alt="Car Insurance">
          <span>Car Insurance</span>
        </div>
        <div class="icon-item" onclick="openInsuranceSubContent('Home Insurance')">
          <img src="https://via.placeholder.com/40" alt="Home Insurance">
          <span>Home Insurance</span>
        </div>
        <div class="icon-item" onclick="openInsuranceSubContent('Travel Insurance')">
          <img src="https://via.placeholder.com/40" alt="Travel Insurance">
          <span>Travel Insurance</span>
        </div>
      </div>
    `;

    // For Wealth
    const wealthContent = `
      <div class="section-title">Wealth Management</div>
      <div class="icon-grid">
        <div class="icon-item" onclick="openWealthSubContent('Investments')">
          <img src="https://via.placeholder.com/40" alt="Investments">
          <span>Investments</span>
        </div>
        <div class="icon-item" onclick="openWealthSubContent('Retirement Plans')">
          <img src="https://via.placeholder.com/40" alt="Retirement Plans">
          <span>Retirement Plans</span>
        </div>
        <div class="icon-item" onclick="openWealthSubContent('Mutual Funds')">
          <img src="https://via.placeholder.com/40" alt="Mutual Funds">
          <span>Mutual Funds</span>
        </div>
        <div class="icon-item" onclick="openWealthSubContent('Tax Planning')">
          <img src="https://via.placeholder.com/40" alt="Tax Planning">
          <span>Tax Planning</span>
        </div>
      </div>
    `;

    // --------------------------
    // Recharge & Bill Payment Sub-Contents
    // --------------------------
    const mobileRechargeContent = `
      <div class="back-button" onclick="showContent('home')">&larr; Back</div>
      <div class="section-title">Mobile Recharge</div>
      <form id="mobileRechargeForm" onsubmit="submitMobileRecharge(event)">
        <input type="text" id="mobileNumber" placeholder="Mobile Number" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="number" id="rechargeAmount" placeholder="Recharge Amount" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="password" id="rechargePassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
        <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Recharge</button>
      </form>
    `;
    const dthRechargeContent = `
      <div class="back-button" onclick="showContent('home')">&larr; Back</div>
      <div class="section-title">DTH Recharge</div>
      <form id="dthRechargeForm" onsubmit="submitDthRecharge(event)">
        <input type="text" id="dthCustomerId" placeholder="Customer ID" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="number" id="dthRechargeAmount" placeholder="Recharge Amount" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="password" id="dthRechargePassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
        <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Recharge</button>
      </form>
    `;
    const electricityBillContent = `
      <div class="back-button" onclick="showContent('home')">&larr; Back</div>
      <div class="section-title">Electricity Bill Payment</div>
      <form id="electricityBillForm" onsubmit="submitElectricityBill(event)">
        <input type="text" id="electricityConsumerId" placeholder="Consumer ID" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="number" id="electricityBillAmount" placeholder="Bill Amount" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="password" id="electricityBillPassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
        <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Pay Bill</button>
      </form>
    `;
    const creditCardPaymentContent = `
      <div class="back-button" onclick="showContent('home')">&larr; Back</div>
      <div class="section-title">Credit Card Payment</div>
      <form id="creditCardPaymentForm" onsubmit="submitCreditCardPayment(event)">
        <input type="text" id="creditCardNumber" placeholder="Credit Card Number" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="number" id="creditCardPaymentAmount" placeholder="Payment Amount" required style="margin-bottom:10px; padding:8px; width:90%;">
        <input type="password" id="creditCardPaymentPassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
        <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Pay Now</button>
      </form>
    `;

    // --------------------------
    // New Sub-Contents for Stores, Insurance & Wealth
    // --------------------------
    // Stores
    function openStoreSubContent(storeName) {
      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = `
        <div class="back-button" onclick="showContent('stores')">&larr; Back</div>
        <div class="section-title">${storeName} Purchase</div>
        <form id="storePurchaseForm" onsubmit="submitStorePurchase(event, '${storeName}')">
          <input type="number" id="storePurchaseAmount" placeholder="Enter purchase amount" required style="margin-bottom:10px; padding:8px; width:90%;">
          <input type="password" id="storePurchasePassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
          <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Purchase</button>
        </form>
      `;
    }
    function submitStorePurchase(event, storeName) {
      event.preventDefault();
      const amount = parseFloat(document.getElementById('storePurchaseAmount').value);
      const enteredPassword = document.getElementById('storePurchasePassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword !== storedPassword) {
        displayNotification('Password confirmation failed. Please try again.', 'error');
        return;
      }
      const balanceKey = 'balance_' + currentUser;
      let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
      if (amount > overallBalance) {
        displayNotification('Insufficient funds for purchase.', 'error');
        return;
      }
      overallBalance -= amount;
      localStorage.setItem(balanceKey, overallBalance);
      const transaction = `Store Purchase at ${storeName} of $${amount.toFixed(2)} on ${new Date().toLocaleString()}`;
      let history = localStorage.getItem('transactionHistory');
      let transactions = history ? JSON.parse(history) : [];
      transactions.push(transaction);
      localStorage.setItem('transactionHistory', JSON.stringify(transactions));
      displayNotification(`Purchase at ${storeName} of $${amount.toFixed(2)} successful!`);
      document.getElementById('storePurchaseForm').reset();
      updateHistoryIfActive();
    }

    // Insurance
    function openInsuranceSubContent(insuranceType) {
      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = `
        <div class="back-button" onclick="showContent('insurance')">&larr; Back</div>
        <div class="section-title">${insuranceType} Plan Purchase</div>
        <form id="insurancePurchaseForm" onsubmit="submitInsurancePurchase(event, '${insuranceType}')">
          <input type="number" id="insurancePremiumAmount" placeholder="Enter premium amount" required style="margin-bottom:10px; padding:8px; width:90%;">
          <input type="password" id="insurancePurchasePassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
          <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Purchase Plan</button>
        </form>
      `;
    }
    function submitInsurancePurchase(event, insuranceType) {
      event.preventDefault();
      const amount = parseFloat(document.getElementById('insurancePremiumAmount').value);
      const enteredPassword = document.getElementById('insurancePurchasePassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword !== storedPassword) {
        displayNotification('Password confirmation failed. Please try again.', 'error');
        return;
      }
      const balanceKey = 'balance_' + currentUser;
      let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
      if (amount > overallBalance) {
        displayNotification('Insufficient funds for insurance purchase.', 'error');
        return;
      }
      overallBalance -= amount;
      localStorage.setItem(balanceKey, overallBalance);
      const transaction = `Insurance Plan Purchase: ${insuranceType} for $${amount.toFixed(2)} on ${new Date().toLocaleString()}`;
      let history = localStorage.getItem('transactionHistory');
      let transactions = history ? JSON.parse(history) : [];
      transactions.push(transaction);
      localStorage.setItem('transactionHistory', JSON.stringify(transactions));
      displayNotification(`Insurance plan ${insuranceType} purchase of $${amount.toFixed(2)} successful!`);
      document.getElementById('insurancePurchaseForm').reset();
      updateHistoryIfActive();
    }

    // Wealth
    function openWealthSubContent(wealthType) {
      const contentArea = document.getElementById('content-area');
      contentArea.innerHTML = `
        <div class="back-button" onclick="showContent('wealth')">&larr; Back</div>
        <div class="section-title">${wealthType} Investment</div>
        <form id="wealthInvestmentForm" onsubmit="submitWealthInvestment(event, '${wealthType}')">
          <input type="number" id="wealthInvestmentAmount" placeholder="Enter investment amount" required style="margin-bottom:10px; padding:8px; width:90%;">
          <input type="password" id="wealthInvestmentPassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
          <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Invest</button>
        </form>
      `;
    }
    function submitWealthInvestment(event, wealthType) {
      event.preventDefault();
      const amount = parseFloat(document.getElementById('wealthInvestmentAmount').value);
      const enteredPassword = document.getElementById('wealthInvestmentPassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword !== storedPassword) {
        displayNotification('Password confirmation failed. Please try again.', 'error');
        return;
      }
      const balanceKey = 'balance_' + currentUser;
      let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
      if (amount > overallBalance) {
        displayNotification('Insufficient funds for investment.', 'error');
        return;
      }
      overallBalance -= amount;
      localStorage.setItem(balanceKey, overallBalance);
      const transaction = `Wealth Investment in ${wealthType} of $${amount.toFixed(2)} on ${new Date().toLocaleString()}`;
      let history = localStorage.getItem('transactionHistory');
      let transactions = history ? JSON.parse(history) : [];
      transactions.push(transaction);
      localStorage.setItem('transactionHistory', JSON.stringify(transactions));
      displayNotification(`Investment in ${wealthType} of $${amount.toFixed(2)} successful!`);
      document.getElementById('wealthInvestmentForm').reset();
      updateHistoryIfActive();
    }

    // --------------------------
    // Recharge & Bill Payment Submit Handlers
    // --------------------------
    function submitMobileRecharge(event) {
      event.preventDefault();
      const mobileNumber = document.getElementById('mobileNumber').value;
      const amount = parseFloat(document.getElementById('rechargeAmount').value);
      const enteredPassword = document.getElementById('rechargePassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword === storedPassword) {
        const balanceKey = 'balance_' + currentUser;
        let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
        if (amount > overallBalance) {
          displayNotification('Insufficient funds for mobile recharge.', 'error');
          return;
        }
        overallBalance -= amount;
        localStorage.setItem(balanceKey, overallBalance);
        const transaction = `Mobile Recharge of $${amount.toFixed(2)} for mobile ${mobileNumber} on ${new Date().toLocaleString()}`;
        let history = localStorage.getItem('transactionHistory');
        let transactions = history ? JSON.parse(history) : [];
        transactions.push(transaction);
        localStorage.setItem('transactionHistory', JSON.stringify(transactions));
        displayNotification(`Mobile recharge of $${amount.toFixed(2)} successful!`);
        document.getElementById('mobileRechargeForm').reset();
        updateHistoryIfActive();
      } else {
        displayNotification('Password confirmation failed. Please try again.', 'error');
      }
    }
    function submitDthRecharge(event) {
      event.preventDefault();
      const customerId = document.getElementById('dthCustomerId').value;
      const amount = parseFloat(document.getElementById('dthRechargeAmount').value);
      const enteredPassword = document.getElementById('dthRechargePassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword === storedPassword) {
        const balanceKey = 'balance_' + currentUser;
        let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
        if (amount > overallBalance) {
          displayNotification('Insufficient funds for DTH recharge.', 'error');
          return;
        }
        overallBalance -= amount;
        localStorage.setItem(balanceKey, overallBalance);
        const transaction = `DTH Recharge of $${amount.toFixed(2)} for Customer ID ${customerId} on ${new Date().toLocaleString()}`;
        let history = localStorage.getItem('transactionHistory');
        let transactions = history ? JSON.parse(history) : [];
        transactions.push(transaction);
        localStorage.setItem('transactionHistory', JSON.stringify(transactions));
        displayNotification(`DTH recharge of $${amount.toFixed(2)} successful!`);
        document.getElementById('dthRechargeForm').reset();
        updateHistoryIfActive();
      } else {
        displayNotification('Password confirmation failed. Please try again.', 'error');
      }
    }
    function submitElectricityBill(event) {
      event.preventDefault();
      const consumerId = document.getElementById('electricityConsumerId').value;
      const amount = parseFloat(document.getElementById('electricityBillAmount').value);
      const enteredPassword = document.getElementById('electricityBillPassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword === storedPassword) {
        const balanceKey = 'balance_' + currentUser;
        let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
        if (amount > overallBalance) {
          displayNotification('Insufficient funds for electricity bill payment.', 'error');
          return;
        }
        overallBalance -= amount;
        localStorage.setItem(balanceKey, overallBalance);
        const transaction = `Electricity Bill Payment of $${amount.toFixed(2)} for Consumer ID ${consumerId} on ${new Date().toLocaleString()}`;
        let history = localStorage.getItem('transactionHistory');
        let transactions = history ? JSON.parse(history) : [];
        transactions.push(transaction);
        localStorage.setItem('transactionHistory', JSON.stringify(transactions));
        displayNotification(`Electricity bill payment of $${amount.toFixed(2)} successful!`);
        document.getElementById('electricityBillForm').reset();
        updateHistoryIfActive();
      } else {
        displayNotification('Password confirmation failed. Please try again.', 'error');
      }
    }
    function submitCreditCardPayment(event) {
      event.preventDefault();
      const cardNumber = document.getElementById('creditCardNumber').value;
      const amount = parseFloat(document.getElementById('creditCardPaymentAmount').value);
      const enteredPassword = document.getElementById('creditCardPaymentPassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (enteredPassword === storedPassword) {
        const balanceKey = 'balance_' + currentUser;
        let overallBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
        if (amount > overallBalance) {
          displayNotification('Insufficient funds for credit card payment.', 'error');
          return;
        }
        overallBalance -= amount;
        localStorage.setItem(balanceKey, overallBalance);
        const transaction = `Credit Card Payment of $${amount.toFixed(2)} for Card ${cardNumber} on ${new Date().toLocaleString()}`;
        let history = localStorage.getItem('transactionHistory');
        let transactions = history ? JSON.parse(history) : [];
        transactions.push(transaction);
        localStorage.setItem('transactionHistory', JSON.stringify(transactions));
        displayNotification(`Credit card payment of $${amount.toFixed(2)} successful!`);
        document.getElementById('creditCardPaymentForm').reset();
        updateHistoryIfActive();
      } else {
        displayNotification('Password confirmation failed. Please try again.', 'error');
      }
    }

    // --------------------------
    // Check Balance Submit Handler
    // --------------------------
    function submitCheckBalance(event) {
      event.preventDefault();
      const entered = document.getElementById('balancePassword').value;
      const storedPassword = localStorage.getItem(currentUser);
      if (entered === storedPassword) {
        refreshBalance();
        document.getElementById('checkBalanceForm').style.display = 'none';
        document.getElementById('refreshBtn').style.display = 'inline-block';
      } else {
        displayNotification('Incorrect password for checking balance.', 'error');
      }
    }
    function refreshBalance() {
      const balanceKey = 'balance_' + currentUser;
      let bankBalance = parseFloat(localStorage.getItem(balanceKey)) || 0;
      let savings = parseFloat(localStorage.getItem('balance_' + currentUser + '_savings')) || 0;
      let currentAcc = parseFloat(localStorage.getItem('balance_' + currentUser + '_current')) || 0;
      const balanceDisplay = document.getElementById('balanceDisplay');
      balanceDisplay.innerHTML = `
        <p><strong>Overall Bank Balance:</strong> $${bankBalance.toFixed(2)}</p>
        <p><strong>Savings Account Balance:</strong> $${savings.toFixed(2)}</p>
        <p><strong>Current Account Balance:</strong> $${currentAcc.toFixed(2)}</p>
      `;
    }

    // --------------------------
    // Open Sub-Content for Home Items
    // --------------------------
    function openSubContent(subSection) {
      const contentArea = document.getElementById('content-area');
      switch (subSection) {
        case 'mobileToMobile':
          contentArea.innerHTML = `
            <div class="back-button" onclick="showContent('home')">&larr; Back</div>
            <div class="section-title">Mobile to Mobile Transfer</div>
            <p>Please fill in the details below and confirm with your password.</p>
            <form id="mobileTransferForm" onsubmit="submitMobileTransfer(event)">
              <input type="text" id="recipientNumber" placeholder="Recipient Mobile Number" required style="margin-bottom:10px; padding:8px; width:90%;">
              <input type="number" id="transferAmount" placeholder="Amount" required style="margin-bottom:10px; padding:8px; width:90%;">
              <input type="password" id="confirmPassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
              <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Transfer</button>
            </form>
          `;
          break;
        case 'toBank':
          contentArea.innerHTML = toBankContent;
          break;
        case 'toSelf':
          contentArea.innerHTML = toSelfContent;
          break;
        case 'checkBalance':
          contentArea.innerHTML = `
            <div class="back-button" onclick="showContent('home')">&larr; Back</div>
            <div class="section-title">Check Balance</div>
            <form id="checkBalanceForm" onsubmit="submitCheckBalance(event)">
              <input type="password" id="balancePassword" placeholder="Enter your password" required style="margin-bottom:10px; padding:8px; width:90%;">
              <button type="submit" style="padding:10px 20px; background-color:#6C45D5; color:#fff; border:none; border-radius:5px; cursor:pointer;">Submit</button>
            </form>
            <div id="balanceDisplay"></div>
            <button onclick="refreshBalance()" style="padding:8px 12px; margin-top:10px; display:none;" id="refreshBtn">Refresh Balance</button>
          `;
          break;
        case 'mobileRecharge':
          contentArea.innerHTML = mobileRechargeContent;
          break;
        case 'dthRecharge':
          contentArea.innerHTML = dthRechargeContent;
          break;
        case 'electricityBill':
          contentArea.innerHTML = electricityBillContent;
          break;
        case 'creditCardPayment':
          contentArea.innerHTML = creditCardPaymentContent;
          break;
        // For Sponsored Links:
        case 'store':
          contentArea.innerHTML = storeContent;
          break;
        case 'insurance':
          contentArea.innerHTML = insuranceContent;
          break;
        case 'wealth':
          contentArea.innerHTML = wealthContent;
          break;
        default:
          showContent('home');
          break;
      }
    }

    // --------------------------
    // Show Content Function for Main Navigation
    // --------------------------
    function showContent(section) {
      const contentArea = document.getElementById('content-area');
      const navLinks = document.querySelectorAll('.phone-nav a');
      navLinks.forEach(link => link.classList.remove('active'));
      switch (section) {
        case 'home':
          contentArea.innerHTML = homeContent;
          navLinks[0].classList.add('active');
          break;
        case 'stores':
          contentArea.innerHTML = storeContent;
          navLinks[1].classList.add('active');
          break;
        case 'insurance':
          contentArea.innerHTML = insuranceContent;
          navLinks[2].classList.add('active');
          break;
        case 'wealth':
          contentArea.innerHTML = wealthContent;
          navLinks[3].classList.add('active');
          break;
        case 'history':
          contentArea.innerHTML = getHistoryContent();
          navLinks[4].classList.add('active');
          break;
      }
    }

    // --------------------------
    // History Functions
    // --------------------------
    function getHistoryContent() {
      let history = localStorage.getItem('transactionHistory');
      let transactions = history ? JSON.parse(history) : [];
      let html = '<div class="section-title">Transaction History</div>';
      html += `<div style="margin-bottom:10px;">
                <button onclick="printHistory()" style="padding:8px 12px; margin-right:10px;">Print</button>
                <button onclick="downloadHistoryPdf()" style="padding:8px 12px;">Download PDF</button>
              </div>`;
      if (transactions.length === 0) {
        html += '<p>No transactions yet.</p>';
      } else {
        html += '<div id="historyContainer">';
        html += '<table>';
        html += '<thead><tr><th>Transaction</th><th>Actions</th></tr></thead>';
        html += '<tbody>';
        transactions.forEach((tx, index) => {
          html += `<tr>
                    <td>${tx}</td>
                    <td>
                      <button onclick="copyTransaction(${index})" style="padding:4px 8px; margin-right: 5px;">Copy</button>
                      <button onclick="deleteTransaction(${index})" style="padding:4px 8px;">Delete</button>
                    </td>
                  </tr>`;
        });
        html += '</tbody></table></div>';
      }
      return html;
    }
    function copyTransaction(index) {
      let history = localStorage.getItem('transactionHistory');
      let transactions = history ? JSON.parse(history) : [];
      let tx = transactions[index];
      navigator.clipboard.writeText(tx)
        .then(() => displayNotification('Transaction copied to clipboard'))
        .catch(err => displayNotification('Failed to copy transaction', 'error'));
    }
    function deleteTransaction(index) {
      let history = localStorage.getItem('transactionHistory');
      let transactions = history ? JSON.parse(history) : [];
      if (confirm('Are you sure you want to delete this transaction?')) {
        transactions.splice(index, 1);
        localStorage.setItem('transactionHistory', JSON.stringify(transactions));
        displayNotification('Transaction deleted');
        showContent('history'); // Refresh the history view
      }
    }
    function printHistory() {
      const historyContentEl = document.getElementById('historyContainer');
      if (historyContentEl) {
        const printWindow = window.open('', '', 'height=600,width=800');
        printWindow.document.write('<html><head><title>Transaction History</title>');
        printWindow.document.write('<style>table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; } th { background-color: #f4f4f4; }</style>');
        printWindow.document.write('</head><body >');
        printWindow.document.write(historyContentEl.outerHTML);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
      } else {
        displayNotification('No transaction history available to print', 'error');
      }
    }
    function downloadHistoryPdf() {
      const element = document.getElementById('historyContainer');
      if (!element) {
        displayNotification('No transaction history to download', 'error');
        return;
      }
      var opt = {
        margin: 0.5,
        filename: 'transaction_history.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }

    // --------------------------
    // Listen for Enter key press on login form fields
    // --------------------------
    document.getElementById('username').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') { login(); }
    });
    document.getElementById('password').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') { login(); }
    });
  </script>
</body>
</html>
